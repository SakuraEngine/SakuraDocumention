---
create: 2023-04-25 01:27
aliases: []
tags: [GUI]
---
# åº“ğŸ˜Š
- ç¼–ç ï¼ˆEncodingï¼‰ï¼ŒåŠŸèƒ½é›†ï¼ˆUtilityï¼‰ ï¼š[OpenString ](https://github.com/Feamber/OpenString)
   - String -> Unicode
- åŒå‘å¸ƒå±€ç®—æ³•ï¼ˆUnicode Bidirectional Algorithmï¼‰ï¼š[ualyze](https://github.com/edmundmk/ualyze) / ICU
   - Unicode -> Run
- ç ç‚¹ï¼ˆCodepointï¼‰åˆ°å­—å½¢ï¼ˆGlyphï¼‰ ï¼š[Harfbuzz](https://github.com/harfbuzz/harfbuzz)
   - Run -> Shapes
- å­—å½¢ï¼ˆGlyphï¼‰åˆ°ä½å›¾ï¼ˆBitmapï¼‰ï¼š[FreeType](https://gitlab.freedesktop.org/freetype)
   - Shapes -> Bitmap
- å¤šè¡Œæ’ç‰ˆï¼ˆMultiline Textï¼‰/ å›¾æ–‡æ··æ’ï¼ˆRichTextï¼‰ ï¼šå‚è€ƒ [skia/skparagraph](https://github.com/google/skia/tree/master/modules/skparagraph)
- æ–‡æœ¬è¾“å…¥ï¼ˆText Editorï¼‰ï¼Œè¾“å…¥ç ï¼ˆIMEï¼‰ï¼šï¼Ÿ
# èµ„æ–™ğŸ˜ƒ
## å¯¼è®ºğŸ˜˜

- [Text Rendering Hates You](https://gankra.github.io/blah/text-hates-you/#style-layout-and-shape-all-depend-on-each-other)
- [Text layout is a loose hierarchy of segmentation](https://raphlinus.github.io/text/2020/10/26/text-layout.html)
- [Fonts and Layout for Global Scripts](https://simoncozens.github.io/fonts-and-layout/)
- [SIGGRAPH 2018 - Digital typography](https://www.slideshare.net/NicolasRougier1/siggraph-2018-digital-typography)
- [CSS Text Module Level 3](https://www.w3.org/TR/2021/CRD-css-text-3-20210316)
## ä»£ç å‚è€ƒğŸ˜¢

- [LayoutNG](https://docs.google.com/document/d/1uxbDh4uONFQOiGuiumlJBLGgO4KDWB8ZEkp7Rd47fw4/edit) (Chrome)
- [Gecko](https://github1s.com/mozilla/gecko-dev/blob/HEAD/gfx/thebes/gfxTextRun.h) (Firefox)
- [Godot](https://github1s.com/godotengine/godot/blob/HEAD/modules/text_server_adv/dynamic_font_adv.h)
- [libtxt](https://github.com/flutter/engine/tree/master/third_party/txt) (android, flutter)
- [skia](https://github.com/google/skia/tree/master/modules/skparagraph) (android, flutter)
- TextMeshProï¼ˆunityï¼‰
- [servo](https://github.com/servo/servo)
# åŸºæœ¬æ¦‚å¿µğŸ¤·â€â™‚ï¸
## å­—ç¬¦ğŸ˜œ

- **characterï¼ˆå­—ç¬¦ï¼‰**ï¼šæ–‡å­—å•å…ƒï¼Œä¸åŒç¼–ç ä¸‹å¯èƒ½é•¿åº¦ä¸åŒã€ä¸åŒè¯­å¢ƒä¸‹å¯èƒ½æœ‰ä¸åŒå«ä¹‰ï¼ˆ_Character_Â is an overloaded term that can mean many things.ï¼‰ã€‘ï¼›
- **codepointï¼ˆç ç‚¹ï¼‰**ï¼šç”¨äºæè¿°ä¸€ä¸ª character çš„æœ€å°åŸå­å•ä½ï¼Œä¸€èˆ¬ä½¿ç”¨32ä½ï¼ˆchar32_tï¼‰ï¼›
- **code unitï¼ˆç å…ƒï¼‰**ï¼šç¼–ç å codepoint çš„å­˜å‚¨å•å…ƒï¼Œå¦‚ utf-8 ç¼–ç ä¸‹ä¸€ä¸ª code unit ä¸º8ä½ï¼›
- **glyphï¼ˆå­—å½¢ï¼‰**ï¼šç”¨äºæ¸²æŸ“çš„æœ€å°åŸå­å•ä½ï¼Œä¸€èˆ¬ä¸€ä¸ª glyph åœ¨å­—ä½“ä¸­æœ‰å”¯ä¸€IDï¼›
- **graphemeï¼ˆå­—ç´ ï¼‰**ï¼šäººç±»å¯è¯»å•å…ƒï¼Œä¸€ä¸ª grapheme å¯èƒ½ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç ç‚¹æ„æˆï¼Œå¦‚ a å’Œå’Œ Ã¤ éƒ½åˆ†åˆ«æ˜¯ä¸€ä¸ª graphemeï¼›
- **ligatureï¼ˆè¿å­—ï¼‰**ï¼šæŒ‡ç”±å¤šä¸ª character æ„æˆçš„ä¸€ä¸ª glyphï¼›
- **hyphenationï¼ˆè¿å­—ç¬¦ï¼‰**ï¼šå•è¯æŒ‰éŸ³èŠ‚è¢«æ‹†åˆ†åˆ°å¤šæ®µæ—¶æ®µå°¾çš„ç¬¦å·ï¼Œä¸€èˆ¬ä¸º '-'
- **ellipsisï¼ˆçœç•¥å·ï¼‰**ï¼šé•¿å¥æ— æ³•æ”¾ç½®åˆ°ç©ºé—´ä¸­æ—¶ï¼Œæˆªæ–­éƒ¨åˆ†æ˜¾ç¤ºçš„ç¬¦å·ï¼Œä¸€èˆ¬ä¸º '...'
- **runï¼ˆå­—æ®µï¼‰**ï¼šåŒ…å«ç›¸åŒ styleï¼Œscriptï¼Œlanguageï¼Œ direction çš„è¿ç»­ textï¼Œæ˜¯ shape çš„åŸºæœ¬å•ä½ï¼›
- **write mode ï¼ˆä¹¦å†™æ¨¡å¼ï¼‰**ï¼šæè¿°æ–‡æœ¬è¡Œæ˜¯æ°´å¹³æ”¾ç½®è¿˜æ˜¯å‚ç›´æ”¾ç½®ï¼Œä»¥åŠæ–‡æœ¬è¡Œå’Œå—è¡Œè¿›çš„æ–¹å‘ï¼›å«ä¸‰ç§å€¼ï¼š
   - horizontal-tbï¼šæ–‡æœ¬è¡Œæ°´å¹³æ’åˆ—ï¼Œä»é¡µé¢çš„é¡¶éƒ¨å‘åº•éƒ¨è¡Œè¿›ã€‚è¿™æ˜¯è®¸å¤šä¹¦å†™ç³»ç»Ÿä¸­ä½¿ç”¨çš„ä¹¦å†™æ¨¡å¼ï¼Œä¾‹å¦‚æ‹‰ä¸è¯­ï¼Œå¸Œè…Šè¯­ï¼Œè¥¿é‡Œå°”å­—æ¯ï¼Œé˜¿æ‹‰ä¼¯è¯­ï¼Œå¸Œä¼¯æ¥è¯­ç­‰ã€‚
   - vertical-rlï¼šæ–‡æœ¬è¡Œå‚ç›´æ’åˆ—ï¼Œä»é¡µé¢çš„å³å‘å·¦è¡Œè¿›ã€‚å¦‚æ±‰è¯­å’Œæ—¥è¯­çš„äºšæ´²è¯­è¨€å¤ä»£ä½¿ç”¨è¿™ç§ä¹¦å†™æ¨¡å¼ã€‚
   - vertical-lrï¼šæ–‡æœ¬è¡Œå‚ç›´æ’åˆ—ï¼Œä»é¡µé¢çš„å·¦å‘å³è¡Œè¿›ã€‚åŸºäºè’™å¤è¯­çš„ä¹¦å†™ç³»ç»Ÿé€šå¸¸ä½¿ç”¨è¿™ç§ä¹¦å†™æ¨¡å¼ã€‚
- **direction ï¼ˆæ–¹å‘ï¼‰**ï¼šHTMLçš„æ ·å¼å±æ€§ï¼Œæè¿°æ–‡å­—ä¹¦å†™æ–¹å‘ï¼›åŒ…å«ä»¥ä¸‹ä¸‰ç§å€¼ï¼š
   - ltrï¼šä¹¦å†™æ–¹å‘ä»å·¦åˆ°å³
   - rtlï¼šä¹¦å†™æ–¹å‘ä»å³åˆ°å·¦
   - initalï¼šé»˜è®¤
- **script **ï¼šä¸€ç§è¯­è¨€çš„æ‰€æœ‰ glyph çš„é›†åˆï¼›
- **emoji **ï¼šğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ¤¬ï¼›
- **cluster **ï¼šä¸å¯åˆ†å‰²çš„ character åºåˆ—ï¼Œå¦‚ä¸€ä¸ªéŸ³èŠ‚ï¼Œä¸åŒäº graphemeï¼Œgrapheme æ˜¯ä¹¦å†™ç³»ç»Ÿæˆ–æ–‡å­—ä¸­æœ€å°çš„æ„ä¹‰å•ä½
## å­—ä½“ğŸ‘€[^](https://www.digitalcitizen.life/simple-questions-what-font-and-what-font-family/)

- **fontï¼ˆå­—ä½“ï¼‰**ï¼šå›ºå®š sizeï¼Œstyleï¼Œtypeface çš„å­—å½¢é›†åˆå«åš fontï¼›
- **styleï¼ˆæ ·å¼ï¼‰**ï¼šå¯¹äº typeface çš„ä¿®é¥°ï¼Œå¦‚**ç²—ä½“ï¼ˆBoldï¼‰**ã€_æ–œä½“ï¼ˆItalic_ï¼‰ï¼›
- **typefaceï¼ˆå­—é¢ï¼‰**ï¼šä¸€å¥—ï¼ˆä¹¦å†™ï¼‰é£æ ¼ç»Ÿä¸€çš„å­—å½¢ï¼›
- **font familyï¼ˆå­—æ—ï¼‰**ï¼šä¸åŒ style çš„ typeface é›†åˆï¼Œä¾‹å¦‚åŒ…å« 16 pt. Bemba Roman æˆ– _**24 pt. Palatino ****Bold Italics**_ï¼›
- **font face (å­—ä½“æ–‡ä»¶ï¼‰**ï¼šä¸€ä¸ªæˆ–å¤šä¸ª font æ–‡ä»¶ï¼Œæ˜¯ font family çš„å­é›†ï¼›
## æ–‡å­—å±æ€§ğŸ˜† [^](https://www.yuque.com/todh0v/izgcgh/kzvc80)
![[Pasted image 20230425012030.png]]
![[Pasted image 20230425011936.png]]
![[Pasted image 20230425012109.png]]
![[Pasted image 20230425012113.png]]
- **advanceï¼ˆæ­¥è¿›ï¼‰**ï¼šglyph ç›¸å¯¹äºä¸Šä¸€ä¸ª glyph çš„åç§»ï¼›
- **alphabetic baseline ï¼ˆå­—æ¯åŸºçº¿ï¼‰**ï¼›
- **ideographic baselineï¼ˆè±¡å½¢åŸºçº¿ï¼‰**ï¼›
- **leading (è¡Œé—´è·ï¼‰**ï¼›
- **strut ï¼ˆå­—æ¶ï¼‰**ï¼šåŒ stem ï¼Ÿ[flutter çš„æ¦‚å¿µ](https://api.flutter.dev/flutter/painting/StrutStyle-class.html)ï¼›
## æ’ç‰ˆğŸ¤”
![[Pasted image 20230425012634.png]]
![[Pasted image 20230425012644.png]]

- **Paragraphï¼ˆæ®µè½ï¼‰**ï¼šæ–‡å­—æ’ç‰ˆçš„å•ä½ï¼ŒåŒ…å«ä»»æ„æ–‡å­—å’Œå›¾ç‰‡ï¼Œä¸€èˆ¬åœ¨ä¸€ä¸ªç‰ˆé¢ï¼ˆä¸€é¡µçº¸ï¼‰å†…ï¼›
- **Stylingï¼ˆåº”ç”¨æ ·å¼ï¼‰**ï¼š
   - Normalization (æ ‡å‡†åŒ–ï¼‰ï¼š[å°†å­—ç¬¦æ›¿æ¢ä¸ºå…¶è§„èŒƒçš„å½¢å¼](https://simoncozens.github.io/fonts-and-layout/unicode.html#normalization-and-decomposition)ï¼›
   - Font Coverageï¼ˆå­—ä½“è¦†ç›–ï¼‰ï¼šæŸ¥è¯¢ font å¹¶åº”ç”¨ fontï¼›
- **Layoutï¼ˆå¸ƒå±€ï¼‰**ï¼š
   - BiDiï¼ˆåŒå‘ç®—æ³•ï¼‰ï¼šè®¡ç®— codepoint æ˜¾ç¤ºé¡ºåºï¼›
   - LineBreakingï¼ˆæ–­è¡Œï¼‰ï¼šå°† Paragraph åˆ†è¡Œï¼›
   - RichTextï¼ˆå¯Œæ–‡æœ¬ï¼‰ï¼šè®¡ç®—å›¾æ–‡æ··æ’ï¼›
- **Shapingï¼ˆé“¸å½¢ï¼‰**ï¼šä» codepoint æ˜ å°„ä¸º glyphã€‚
# æ’ç‰ˆæµç¨‹ğŸ¤¢

1. æ„å»º Paragraphï¼ŒåŒ…å«å¤šæ®µæ–‡å­—å’Œå¯¹åº”çš„ Styleï¼ˆä»¥åŠéæ–‡å­—å…ƒç´ ï¼‰
2. Build Run
   1. è¿è¡Œ BiDi ç®—æ³•ï¼Œæ”¶é›†æ–¹å‘ä¿¡æ¯
   2. è¿è¡Œ Font Coverageï¼Œå¤„ç†å­—ä½“ä¿¡æ¯
   3. è¿è¡Œ Text ç®—æ³•ï¼Œæ”¶é›†è¯­ç³»ä¿¡æ¯
   4. å°†æ–‡æœ¬æ‹†åˆ†ä¸ºä¿¡æ¯è¿ç»­çš„ç‰‡æ®µ Run
3. Shape Paragraph to Infinite Line
   1. ä½¿ç”¨ Shaperï¼ˆharfbuzzï¼‰å¯¹æ¯ä¸ª Run æ‰§è¡Œ Shaping ç®—æ³• 
4. Cluster
   1. ä» Shaped Text æ„å»ºåå‘çš„ [Cluster : Codepoint] æ˜ å°„è¡¨
5. Space
   1. è®¡ç®—å­—é—´è·å’Œè¯é—´è·
6. LineBreaking
   1. è®¡ç®—ç©ºè¡Œ
   2. å°è¯•ä»¥ Cluster ä¸ºå•ä½å¡«å……è¡Œç›´åˆ°æ»¡ï¼ˆå½“å¯ç”¨è¿å­—ç¬¦çš„æ—¶å€™ï¼Œåˆ™ä»¥è¯ä¸ºå•ä½ï¼‰
   3. å»æ‰å¼€å¤´å’Œç»“å°¾[å¯å»æ‰çš„ç©ºå­—ç¬¦](https://www.w3.org/TR/2021/CRD-css-text-3-20210316/#propdef-white-space)ï¼ˆæ³¨æ„ä¸èƒ½åˆ é™¤å¸¦æœ‰ä¸‹åˆ’çº¿çš„å­—ç¬¦ï¼‰
   4. è®°å½•è¡Œï¼Œé‡å¤ a ç›´åˆ°è¾¾åˆ°é™åˆ¶æˆ–æ²¡æœ‰å¯å¡«å……çš„ Cluster æˆ–è€…è¶…å‡ºæœ€å¤§é«˜åº¦é™åˆ¶
   5. å¦‚æœè¾¾åˆ°è¡Œæ•°/é«˜åº¦é™åˆ¶ï¼Œåˆ™å›æ»šåˆ°æœ€åä¸€è¡Œé‡æ–°æ’ç‰ˆå¹¶è£å‰ªï¼Œé€‰æ‹©æ€§æ·»åŠ çœç•¥å·
7. Formatting
   1. æ ¹æ®è®¾ç½®æ‰§è¡Œå¯¹é½ç®—æ³•ï¼Œä¸»è¦ä¸º justify
   2. justify å¯èƒ½ä¼šæŸ¥è¯¢ font çš„ JSTF è¡¨ï¼ŒJSTF è¡¨å…è®¸æŠŠè¿ä½“çš„å­—ç¬¦é‡æ–°æ‹†å¼€ä¸ºå•ç‹¬çš„å­—ç¬¦ä»¥æ‰©å±•ç©ºé—´
8. è¿›å…¥æ¸²æŸ“æµç¨‹
# æ¸²æŸ“æµç¨‹ğŸ™ƒ

1. æ‰“å¼€å­—ä½“æ–‡ä»¶ï¼›
2. è®¾ç½®ä¸€ç»„å…‰æ …åŒ–å‚æ•°ï¼Œå¯¹äºä¸€ä¸ªå­—é¢æ¥è¯´è¿™å¾€å¾€æ˜¯å›ºå®šçš„ï¼Œå³æ¯ä¸ªå­—é¢ä¸€ä¸ªå›ºå®šçš„å…‰æ …åŒ–ç®¡é“ï¼š
   1. è®¾ç½®å­—ç¬¦å¤§å°ï¼Œ[DPIç­‰](http://jcgt.org/published/0002/01/04/)ä½œä¸ºå¤–éƒ¨å› ç´ åœ¨æ­¤å¤„ä»‹å…¥  ----> FT_Set_Char_Size(*face,Â convert_float_to_F26Dot6(size),Â 0,Â DPIÂ *Â HRES,Â DPI); //HRES as DPIæ¨ªå‘Factorï¼›
   2. è®¾ç½® Transformï¼Œä¸€èˆ¬æ¥è¯´è¢«ç”¨æ¥é€‚é… DPI æˆ–è€… HRESï¼›
   3. ä¸€äº› AAA æˆ–æ¬¡åƒç´ çº§åˆ«çš„é¢å¤–ç‰¹æ€§ï¼Œä¾‹å¦‚ LCDFilter ç­‰ï¼›
   4. ä¸€äº›å¯¹å­—å½¢çš„åå¤„ç†è®¾ç½®ï¼Œä¾‹å¦‚ FreeType çš„ Glyph Strokerï¼›
3. ä»æ’ç‰ˆç»“æœè·å– Font å’Œ Glyph ID å¹¶è¿›è¡Œå…‰æ …åŒ–ï¼Œå…‰æ …åŒ–çš„ç›®æ ‡å¾€å¾€æ˜¯ä¸€å—å›ºå®šå¤§å°çš„ Atlasï¼Œç©ºçš„ç ç‚¹è¾“å…¥ä¼šæœ‰æ„ä¹‰åœ°å®šå‘åˆ°ä¸‹åˆ’çº¿ç»˜åˆ¶ä¸Šï¼›
4. è·å– Glyph çš„ Kerning ä¿¡æ¯ï¼Œæ ¹æ®å¯¹é½è·å¾—åˆå§‹ä½ç½®ï¼Œå®Œæˆæ•´ä¸ªæ¸²æŸ“æµç¨‹ã€‚
# ç¼–è¾‘æµç¨‹ğŸ˜±
TODO
# Milestone1ğŸ‘¨â€ğŸ¦³

- [x] font manager
   - æŸ¥è¯¢å­—ä½“
   - åº”å¯¹ fallback çš„æƒ…å†µï¼ˆç³»ç»Ÿå­—ä½“ï¼‰
   - ç®¡ç†å­—ä½“åŠ è½½ï¼Ÿ
- [x] typeface / fontstyle
- [x] shaper
   - æŠ½è±¡ harfbuzz
   - å¡«å…… run æ•°æ®
- [x] run
   - text rangeï¼Œcluster range
   - glyph, position, cluster, bounds
   - advance, fontï¼Œbidilevel
- [x] run builder
   - bidi ç®—æ³•
   - æ ‡è®° unicode flag
   - æ‹†åˆ† run
- [x] shape
   - å¯¹æ¯ä¸ª run è°ƒç”¨ shaper
- [x] paragraph
   - å‚¨å­˜è¾“å…¥æ•°æ®ï¼ˆtextï¼Œstyleï¼‰
   - æ§åˆ¶ layout phaseï¼Œå‚¨å­˜ä¸­é—´ç»“æ„
   - æœ€åè¾“å‡º array of line
- [x] paragraph builder
   - å±•å¹³ text element çš„å±‚çº§ç»“æ„ï¼Œç”Ÿæˆ paragraph
# Milestone2ğŸ‘¨ğŸ¼â€ğŸ¦³

- [x] space
- [ ] å­—é—´è·
- [ ] è¯é—´è·
- [x] è¡Œé—´è·
- [x] linebreaker
   - æ–­è¡Œç®—æ³•
   - ç©ºå­—ç¬¦å‰”é™¤ç®—æ³•
   - è¿å­—ç¬¦ç®—æ³•
- [ ] textstyle
   - åˆ’çº¿ï¼ˆä¸Šä¸­ä¸‹ï¼‰
# Milestone3ğŸ‘¨ğŸ¾â€ğŸ¦³

- [x] format
   - å·¦å¯¹é½
   - å³å¯¹é½
   - ä¸¤ç«¯å¯¹é½ï¼ˆjustifyï¼‰
- [x] è¡Œå†…æ§ä»¶
- [x] æ ‡å¤´ä¸‹æ²‰ï¼ˆdropcapï¼‰
- [ ] hit test
- [x] trim
   - çœç•¥ç¬¦
   - å‰”é™¤å•è¯
   - å‰”é™¤å­—æ¯
# Milestone4ğŸ‘¨ğŸ¿â€ğŸ¦³

- [ ] font JSTF
- [ ] cursor
- [ ] selection
- [ ] IME
